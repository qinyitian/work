<!DOCTYPE html>
<html  xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>确定中标企业</title>
	<!-- Import google fonts - Heading first/ text second -->
	<!-- <link rel='stylesheet' type='text/css' href='http://fonts.useso.com/css?family=Open+Sans:400,700|Droid+Sans:400,700' /> -->
	<!--[if lt IE 9]>
	<link href="http://fonts.useso.com/css?family=Open+Sans:400" rel="stylesheet" type="text/css" />
	<link href="http://fonts.useso.com/css?family=Open+Sans:700" rel="stylesheet" type="text/css" />
	<link href="http://fonts.useso.com/css?family=Droid+Sans:400" rel="stylesheet" type="text/css" />
	<link href="http://fonts.useso.com/css?family=Droid+Sans:700" rel="stylesheet" type="text/css" />
	<![endif]-->
	<!-- Favicon and touch icons -->
	<link rel="shortcut icon" href="../asset/ico/favicon.ico" type="image/x-icon" />
	<!-- Css files -->
	<link href="../asset/css/bootstrap.min.css" rel="stylesheet">
	<link href="../asset/css/jquery.mmenu.css" rel="stylesheet">
	<link href="../asset/css/font-awesome.min.css" rel="stylesheet">
	<link href="../asset/plugins/jquery-ui/css/jquery-ui-1.10.4.min.css" rel="stylesheet">
	<link href="../asset/css/style.min.css" rel="stylesheet">
	<link href="../asset/css/add-ons.min.css" rel="stylesheet">
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="../asset/js/html5shiv.js"></script>
	<script src="../asset/js/respond.min.js"></script>
	<![endif]-->
</head>
<body>
<!-- start: Header -->
<div class="navbar" role="navigation">
	<div class="container-fluid">
		<ul class="nav navbar-nav navbar-right">
			<li class="dropdown visible-md visible-lg">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img class="user-avatar" src="../asset/img/avatar.jpg" alt="user-mail">政府后台管理员</a>
			</li>
			<li><a href="Home.html"><i class="fa fa-power-off"></i></a></li>
		</ul>
	</div>
</div>
<!-- end: Header -->
<!-- start:    左侧导航栏    -->
<div class="container-fluid content">
	<div class="row">
		<!-- start: Main Menu -->
		<div class="sidebar ">
			<div class="sidebar-collapse">
				<div class="sidebar-header t-center">
				  	<br>
                    <h2>政府后台</h2>
				</div>
				<div class="sidebar-menu">
					<ul class="nav nav-sidebar">
						<li><a href="../Admin_Index.html"><i class="fa fa-laptop"></i><span class="text">主页</span></a></li>
						<li>
							<a href="#"><i class="fa fa-font"></i><span class="text">首页管理</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="#"><i class="fa fa-th"></i><span class="text">头部导航栏管理</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">文章管理</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">内容管理</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">底部导航栏管理</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-signal"></i><span class="text">服务管理</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="../System_Service/equipment_service.html"><i class="fa fa-list"></i><span class="text">器材管理</span></a></li>
								<li><a href="../System_Service/field_service.html"><i class="fa fa-list"></i><span class="text">场地服务管理</span></a></li>
								<li><a href="../System_Service/sport_service.html"><i class="fa fa-list"></i><span class="text">赛事服务管理</span></a></li>
								<li><a href="../System_Service/artificial_service.html"><i class="fa fa-list"></i><span class="text">人工服务管理</span></a></li>
								<li><a href="../System_Service/activity_service.html"><i class="fa fa-list"></i><span class="text">活动服务管理</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-signal"></i><span class="text">需求</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="../System_Demand/demand_table_input.html"><i class="fa fa-table"></i><span class="text">发布需求调查表</span></a></li>
								<li><a href="../System_Demand/demand_table_list.html"><i class="fa fa-list"></i><span class="text">调查表管理</span></a></li>
								<li><a href="../System_Demand/demand_directory.html"><i class="fa fa-list"></i><span class="text">需求目录管理</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-file-text"></i><span class="text">招标</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="publish_tender_plan.html"><i class="fa fa-pencil"></i><span class="text">发布招标计划</span></a></li>
								<!--<li><a href="/System_TenderPlan/goverment_check_evalution.html"><i class="fa fa-table"></i><span class="text">查看招标计划</span></a></li>-->
								<li><a href="set_pass_company.html"><i class="fa fa-table"></i><span class="text">确定竞标企业</span></a></li>
								<li><a href="set_win_company.html"><i class="fa fa-table"></i><span class="text">确定中标企业</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-file-text"></i><span class="text">评价报告</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="../System_Assess/check_assess_report.html"><i class="fa fa-pencil"></i><span class="text">查看评价报告</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-font"></i><span class="text">认证</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="#"><i class="fa fa-th"></i><span class="text">企业认证</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">媒体认证</span></a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
			<div class="sidebar-footer">
				<div class="sidebar-brand">
					政府后台
				</div>
			</div>
		</div>
	</div>
	<!-- end:    左侧导航栏   -->
	<!-- start:  招标目录表   -->
	<div class="main sidebar-minified">
		<div class="row">
			<div class="col-lg-12">
				<h3 class="page-header"><i class="fa fa-table"></i>确定中标企业</h3>
				<ol class="breadcrumb">
					<li><i class="fa fa-home"></i><a href="Home.html">主页</a></li>
					<li><i class="fa fa-table"></i>确定中标企业</li>
				</ol>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2><i class="fa fa-table red"></i><span class="break"></span><strong>招标计划</strong></h2>
					</div>
					<div class="panel-body">
						<table id="tenderPlanTable">
													
						</table>
					</div>
				</div>
			</div><!--/col-->
		</div><!--/row-->
	</div>
</div>
<br><br><br>
<!--这段是悬浮窗的代码-->
<div class="modal fade" id="TenderPlanModal">
	<div class="modal-dialog" style="top: 46px;width:900px;">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">竞标公司</h4>
			</div>
			<div class="modal-body">
				<table id="TenderCompanyTable">
					
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="setWinCompany" onclick="setWinCompany()">确定中标公司</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- start: JavaScript-->
<!--[if !IE]>-->
<script src="../asset/js/jquery-2.1.1.min.js"></script>
<!--<![endif]-->
<!--[if IE]>
<script src="../asset/js/jquery-2.1.1.min.js"></script>
<![endif]-->
<!--[if !IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-2.1.1.min.js'>"+"<"+"/script>");
</script>
<!<![endif]-->
<!--[if IE]>
<script type="text/javascript">
	window.jQuery || document.write("<script src='assets/js/jquery-1.11.1.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
<script src="../asset/js/jquery-migrate-1.2.1.min.js"></script>
<script src="../asset/js/bootstrap.min.js"></script>
<!-- page scripts -->
<script src="../asset/plugins/jquery-ui/js/jquery-ui-1.10.4.min.js"></script>
<script src="../asset/plugins/datatables/js/jquery.dataTables.min.js"></script>
<script src="../asset/plugins/datatables/js/dataTables.bootstrap.min.js"></script>
<!-- theme scripts -->
<script src="../asset/js/SmoothScroll.js"></script>
<script src="../asset/js/jquery.mmenu.min.js"></script>
<script src="../asset/js/core.min.js"></script>
<!-- end: JavaScript-->
<script src="../asset/js/jquery-2.1.1.min.js"></script>
<script src="../asset/js/avalon.js"></script>
<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css"> -->
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/bootstrap-table.js"></script>
<script src="../js/bootstrap-table-zh-CN.min.js"></script>
<!---->
<!--以下代码是实现查看详情 的js代码-->
<!---->
<script>
	//
	$('#test').click(function(){
		$('#TenderPlanModal').modal('show');
	});
	//获取招标计划ID
	var TenderPlanID;
 	//
	$('#tenderPlanTable').bootstrapTable({
	    url:"../TenderCompany/ShowTenderPlan",
	    //请求方法
	    method: 'get',
	    //dataType: "json",
	    //是否显示行间隔色
	    striped: true,
	    //是否显示 切换试图（table/card）按钮
	    showToggle: "true",
	    //显示搜索框 
	    search: "true", 
	    //显示刷新
	    showRefresh : "true",
	    //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）     
	    cache: false,    
	    //是否显示分页（*）  
	    pagination: true,   
	     //是否启用排序  
	    sortable: true,    
	     //排序方式 
	    sortOrder: "asc",
	    //如果设置了分页，首页页码     
	    pageNumber: 1,   
	    //每页的记录行数（*）   
	    pageSize: 10,  
	    //可供选择的每页的行数（*）    
	    pageList: [10, 25, 50, 100],
	    //客户端处理分页    
	    sidePagination: "client",
	    //指定主键列 idField: "fieldID",
	    columns: [
	        {
	            field: 'tenderPlanID',//域值
	            title: '招标ID',//标题
	            visible: false,//false表示不显示
	        },{
	            field: 'tenderPlanName',//域值
	            title: '招标名',//标题
	            visible: true,//false表示不显示
	        },{
	            field: 'tenderPlanStartTime',//域值
	            title: '招标开始时间',//标题
	            visible: true,//false表示不显示
	        },{
	            field: 'tenderPlanEndTime',//域值
	            title: '招标结束时间',//标题
	            visible: true,//false表示不显示
	        },{
	            field: 'tenderPlanFilePath',//域值
	            title: '招标文件路径',//标题
	            visible: false,//false表示不显示
	        },{
	            field: 'voteEndTime',//域值
	            title: '项目投票结束时间',//标题
	            visible: true,//false表示不显示
	        },{
	            title: '操作',//标题
	            visible: true,//false表示不显示
	            formatter:ActionFormatter,
	            events:window.ActionEvent = {
	                'click .check':function (e,value,row,index) {
	                     TenderPlanID = row['tenderPlanID'];
	                     $('#TenderPlanModal').modal('show');
	                     loadCompany(TenderPlanID);   
	                    }
	                }
	                
	        }
	    ]
	});
    //
    function ActionFormatter(value, row, index){
        return [
                '<a class="check" title="Check" style="display: inline;font-size: 12px;"> 查看竞标公司 </a>'
        ].join('');
    };
    //
    function loadCompany(id){
    	$('#TenderCompanyTable').bootstrapTable({
    		url:"../TenderCompany/getCheckCompany?TenderPlanID="+id,
		    //请求方法
		    method: 'get',
		    //dataType: "json",
		    //是否显示行间隔色
		    striped: true,
		    //是否显示 切换试图（table/card）按钮
		    showToggle: "true",
		    //显示搜索框 
		    search: "true", 
		    //显示刷新
		    showRefresh : "true",
		    //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）     
		    cache: false,    
		    //是否显示分页（*）  
		    pagination: true,   
		     //是否启用排序  
		    sortable: true,    
		     //排序方式 
		    sortOrder: "asc",
		    //如果设置了分页，首页页码     
		    pageNumber: 1,   
		    //每页的记录行数（*）   
		    pageSize: 10,  
		    //可供选择的每页的行数（*）    
		    pageList: [10, 25, 50, 100],
		    //客户端处理分页    
		    sidePagination: "client",
		    //指定主键列 idField: "fieldID",
		    columns: [
	    		{
                    checkbox: true, 
                },
                {
                    field: 'companyID',//域值
                    title: '企业ID',//标题
                    visible: false,//false表示不显示
                },{
                    field: 'companyName',//域值
                    title: '企业名称',//标题
                    visible: true,//false表示不显示
                },{
                    field: 'companyAddress',//域值
                    title: '地址',//标题
                    visible: true,//false表示不显示
                },{
                    field: 'companyEmail',//域值
                    title: '邮箱',//标题
                    visible: true,//false表示不显示
                },{
                    field: 'companyBusinessScope',//域值
                    title: '业务范围',//标题
                    visible: true,//false表示不显示
                },{
                    field: 'businessLicense',//域值
                    title: '营业执照',//标题
                    visible: false,//false表示不显示
                }
		    ]
    	});
    };    
    //确定中标公司
    function setWinCompany(){
    	console.log("进行确定中标公司！");
        var formData = new FormData();       
        var companyID =$.map( $('#TenderCompanyTable').bootstrapTable('getSelections'), function (row) {
            return row.companyID;
        });
        if(companyID.length > 1){
        	alert("只能选择一家公司！");
        	return false;
        }
        formData.append('TenderPlanID',TenderPlanID);
        formData.append('CompanyID',companyID[0]);
        console.log("提交中标公司！");
        $.ajax({
        	url: '../TenderCompany/setWinBidCompany',
            type: 'POST',
            cache: false,
            data: formData,//向后台提交的参数
            processData: false,
            contentType: false,
        }).done(function(data){
            alert("提交成功！");
            $("#TenderPlanModal").modal('hide');
        }).fail(function(msg){
             alert(msg);
        }); 
    }
</script>
</body>
</html>