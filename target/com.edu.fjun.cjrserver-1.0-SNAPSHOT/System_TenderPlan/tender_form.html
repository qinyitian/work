<!DOCTYPE html>
<html  xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>已发布招标项目表</title>
	<!-- Import google fonts - Heading first/ text second -->
	<!-- <link rel='stylesheet' type='text/css' href='http://fonts.useso.com/css?family=Open+Sans:400,700|Droid+Sans:400,700' /> -->
	<!--[if lt IE 9]>
	<link href="http://fonts.useso.com/css?family=Open+Sans:400" rel="stylesheet" type="text/css" />
	<link href="http://fonts.useso.com/css?family=Open+Sans:700" rel="stylesheet" type="text/css" />
	<link href="http://fonts.useso.com/css?family=Droid+Sans:400" rel="stylesheet" type="text/css" />
	<link href="http://fonts.useso.com/css?family=Droid+Sans:700" rel="stylesheet" type="text/css" />
	<![endif]-->
	<!-- Favicon and touch icons -->
	<link rel="shortcut icon" href="../asset/ico/favicon.ico" type="image/x-icon" />
	<!-- Css files -->
	<link href="../asset/css/bootstrap.min.css" rel="stylesheet">
	<link href="../asset/css/jquery.mmenu.css" rel="stylesheet">
	<link href="../asset/css/font-awesome.min.css" rel="stylesheet">
	<link href="../asset/plugins/jquery-ui/css/jquery-ui-1.10.4.min.css" rel="stylesheet">
	<link href="../asset/css/style.min.css" rel="stylesheet">
	<link href="../asset/css/add-ons.min.css" rel="stylesheet">
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="../asset/js/html5shiv.js"></script>
	<script src="../asset/js/respond.min.js"></script>
	<![endif]-->
</head>
<body>
<!-- start: Header -->
<div class="navbar" role="navigation">
	<div class="container-fluid">
		<ul class="nav navbar-nav navbar-right">
			<li class="dropdown visible-md visible-lg">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img class="user-avatar" src="../asset/img/avatar.jpg" alt="user-mail">政府后台管理员</a>
			</li>
			<li><a href="Home.html"><i class="fa fa-power-off"></i></a></li>
		</ul>
	</div>
</div>
<!-- end: Header -->
<!-- start:    左侧导航栏    -->
<div class="container-fluid content">
	<div class="row">
		<!-- start: Main Menu -->
		<div class="sidebar ">
			<div class="sidebar-collapse">
				<div class="sidebar-header t-center">
				  	<br>
                    <h2>政府后台</h2>
				</div>
				<div class="sidebar-menu">
					<ul class="nav nav-sidebar">
						<li><a href="../Admin_Index.html"><i class="fa fa-laptop"></i><span class="text">主页</span></a></li>
						<li>
							<a href="#"><i class="fa fa-font"></i><span class="text">首页管理</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="#"><i class="fa fa-th"></i><span class="text">头部导航栏管理</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">文章管理</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">内容管理</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">底部导航栏管理</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-signal"></i><span class="text">服务管理</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="/System_Service/equipment_service.html"><i class="fa fa-list"></i><span class="text">器材管理</span></a></li>
								<li><a href="/System_Service/field_service.html"><i class="fa fa-list"></i><span class="text">场地服务管理</span></a></li>
								<li><a href="/System_Service/activity_service.html"><i class="fa fa-list"></i><span class="text">活动服务管理</span></a></li>
								<li><a href="/System_Service/sport_service.html"><i class="fa fa-list"></i><span class="text">赛事服务管理</span></a></li>
								<li><a href="/System_Service/artificial_service.html"><i class="fa fa-list"></i><span class="text">人工服务管理</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-signal"></i><span class="text">需求</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="/System_Demand/demand_table_input.html"><i class="fa fa-table"></i><span class="text">需求调查表</span></a></li>
								<li><a href="/System_Demand/demand_table_list.html"><i class="fa fa-list"></i><span class="text">调查表</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-file-text"></i><span class="text">招标</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="/System_TenderPlan/publish_tender_plan.html"><i class="fa fa-pencil"></i><span class="text">发布招标计划</span></a></li>
								<!--<li><a href="/System_TenderPlan/goverment_check_evalution.html"><i class="fa fa-table"></i><span class="text">查看招标计划</span></a></li>-->
								<li><a href="/System_TenderPlan/set_pass_company.html"><i class="fa fa-table"></i><span class="text">确定竞标企业</span></a></li>
								<li><a href="/System_TenderPlan/set_win_company.html"><i class="fa fa-table"></i><span class="text">确定中标企业</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-file-text"></i><span class="text">评价报告</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="/System_Assess/check_assess_report.html"><i class="fa fa-pencil"></i><span class="text">查看评价报告</span></a></li>
							</ul>
						</li>
						<li>
							<a href="#"><i class="fa fa-font"></i><span class="text">认证</span> <span class="fa fa-angle-down pull-right"></span></a>
							<ul class="nav sub">
								<li><a href="#"><i class="fa fa-th"></i><span class="text">企业认证</span></a></li>
								<li><a href="#"><i class="fa fa-th"></i><span class="text">媒体认证</span></a></li>
							</ul>
						</li>
					</ul>
				</div>
			</div>
			<div class="sidebar-footer">
				<div class="sidebar-brand">
					政府后台
				</div>
			</div>
		</div>
	</div>
	<!-- end:    左侧导航栏   -->
	<!-- start:  招标目录表   -->
	<div class="main sidebar-minified">
		<div class="row">
			<div class="col-lg-12">
				<h3 class="page-header"><i class="fa fa-table"></i>公布的招标项目</h3>
				<ol class="breadcrumb">
					<li><i class="fa fa-home"></i><a href="Home.html">主页</a></li>
					<li><i class="fa fa-table"></i>公布的招标项目</li>
				</ol>
			</div>
		</div>
		<!--  已发布项目  -->
		<div class="form-group">
			<div class="row">
				 <div class="col-md-2 text-center" for="name_input" ><h5 class="h5"><strong>招标名字:</strong></h5></div>
				<div class="col-md-3">
					<input type="text" id="TenderPlanName_input" name="text_input" class="form-control" placeholder="招标名字"
						   data-toggle="modal" data-target="#TenderPlanModal">
				</div>
				<div class="col-md-2 col-md-offset-5">
					<button id="WidBiding" class="btn btn-success">发布招标结果</button>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2><i class="fa fa-table red"></i><span class="break"></span><strong>企业详情</strong></h2>
					</div>
					<div class="panel-body">
						<table data-toggle="table" id="CompanyInfo">
							<thead>
							<tr>
								<th data-checkbox="true"></th>
								<th data-field="company_Name">企业</th>
								<th data-field="company_Address">地址</th>
								<th data-field="company_Email">邮箱</th>
								<th data-field="company_BusinessScope">经营范围</th>
								<th data-field="business_License">执照号</th>
								<th data-field="action" data-formatter="CompanyActionFormatter" data-events="CompanyActionEvents">查看</th>
							</tr>
							</thead>
						</table>
					</div>
				</div>
			</div><!--/col-->
		</div><!--/row-->
	</div>
</div>
<br><br><br>
<!--这段是悬浮窗的代码-->
<div class="modal fade" id="TenderPlanModal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">招标选择</h4>
			</div>
			<div class="modal-body">
				<table id="TenderPlanTable" data-toggle="table">
					<thead>
					<tr>
						<th data-field="tenderPlan_ID">招标编号</th>
						<th data-field="tenderPlan_name">招标计划名</th>
						<th data-field="tenderPlan_StartTime">开始时间</th>
						<th data-field="tenderPlan_EndTime">结束时间</th>
						<th data-field="action" data-formatter="actionFormatter" data-events="TenderactionEvents">添加</th>
					</tr>
					</thead>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- start: JavaScript-->
<!--[if !IE]>-->
<script src="../asset/js/jquery-2.1.1.min.js"></script>
<!--<![endif]-->
<!--[if IE]>
<script src="../asset/js/jquery-2.1.1.min.js"></script>
<![endif]-->
<!--[if !IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-2.1.1.min.js'>"+"<"+"/script>");
</script>
<!<![endif]-->
<!--[if IE]>
<script type="text/javascript">
	window.jQuery || document.write("<script src='assets/js/jquery-1.11.1.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
<script src="../asset/js/jquery-migrate-1.2.1.min.js"></script>
<script src="../asset/js/bootstrap.min.js"></script>
<!-- page scripts -->
<script src="../asset/plugins/jquery-ui/js/jquery-ui-1.10.4.min.js"></script>
<script src="../asset/plugins/datatables/js/jquery.dataTables.min.js"></script>
<script src="../asset/plugins/datatables/js/dataTables.bootstrap.min.js"></script>
<!-- theme scripts -->
<script src="../asset/js/SmoothScroll.js"></script>
<script src="../asset/js/jquery.mmenu.min.js"></script>
<script src="../asset/js/core.min.js"></script>
<!-- end: JavaScript-->
<script src="../asset/js/jquery-2.1.1.min.js"></script>
<script src="../asset/js/avalon.js"></script>
<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css"> -->
<script src="../js/bootstrap.min.js"></script>
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/bootstrap-table.js"></script>
<script src="../js/bootstrap-table-zh-CN.min.js"></script>
<!---->
<!--以下代码是实现查看详情 的js代码-->
<!---->
<script>
    var TenderID;
    function CompanyActionFormatter(value, row, index) {
        return [
            '<button type="button" class="btn btn-default" data-toggle="modal" data-target="#CompanyInfoModal">查看详情</button>'
        ].join('');
    }
    window.CompanyActionEvents = {
        'click .btn': function (e, value, row, index) {

        }
    };
    function actionFormatter(value, row, index) {
        return [
            '<a class="like" href="javascript:void(0)" title="Like"  data-dismiss="modal">',
            '<i class="glyphicon glyphicon-plus"></i>',
            '</a>'
        ].join('');
    }
    window.TenderactionEvents = {
        'click .like': function (e, value, row, index) {
            document.getElementById("TenderPlanName_input").value=row['tenderPlan_name'];
            TenderID = row['tenderPlan_ID'];
            //根据招标计划ID查询对应companyinfo
            $.ajax({
                type: "POST",
                url:"/TenderPlan/ReturnTenderPlanCompany?TenderPlanID="+row['tenderPlan_ID'],
                success: function(msg){
                    $('#CompanyInfo').bootstrapTable('load',msg);
                }
            });
        }
    };
    //点击事件
    $('#TenderPlanName_input').click(function (){
        //隐藏ID列
        $('#TenderPlanTable').bootstrapTable('hideColumn', 'tenderPlan_ID');
        //重新加载悬浮窗TenderPlanTable数据
        $.ajax({
            type: "POST",
            url:"/TenderPlan/ReturnTenderPlan",
            success: function(msg){
                $('#TenderPlanTable').bootstrapTable('load',msg);
            }
        });
    });
    //点击事件
    $('#searchInfo').click(function (){
        //根据招标计划ID查询对应companyinfo
        $.ajax({
            type: "POST",
            url:"/TenderPlan/ReturnTenderPlanCompany?TenderPlanID="+TenderID,
            success: function(msg){
                $('#CompanyInfo').bootstrapTable('load',msg);
            }
        });
    });

    //添加投标结果
    $('#WidBiding').click(function () {
        var TenderPlanName = document.getElementById("TenderPlanName_input").value;
        if (TenderPlanName != "") {
            var ids = $.map($('#CompanyInfo').bootstrapTable('getSelections'), function (row) {
                return row.id;
            });
            $('#CompanyInfo').bootstrapTable('remove', {
                field: 'id',
                values: ids
            });
            var allTableData = $('#CompanyInfo').bootstrapTable('getSelections');
            if(allTableData != "") {
                //获取悬浮框数据
                var CompanyNameList = new Array();
                var allTableData2 = JSON.stringify(allTableData);
                //获取json中demand_ID,生成数组
                for (var i = 0; i < eval(allTableData2).length; i++) {
                    CompanyNameList[i] = allTableData[i].company_Name;//这里不能用已经转换的JSON格式，要用原本的
                }
                $.ajax({
                    type: "post",
                    traditional: true,
                    url: "/TenderPlan/WinBidCompanyAdd",//请求地址
                    data: {"TenderPlanName": TenderPlanName, "CompanyNameList": CompanyNameList},//向后台提交的参数
                    success: function (data) {
                        alert("发布成功");
                        window.location.reload();
//                        window.location.href = "Floder.html";
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(XMLHttpRequest.status);
                        alert(XMLHttpRequest.readyState);
                        alert(textStatus);
                    },
                })
            }
            else
			{
			    alert("请选择招标公司");
			}
        }
        else
		{
		    alert("请选择招标名字");
		}
    });



</script>
</body>
</html>